rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // Helper function to check if user is admin
    // Only authorized emails are admins
    function isAdmin() {
      return request.auth != null 
        && (request.auth.token.email == 'kpnjensen@gmail.com'
            || request.auth.token.email == 'chairachananharder@gmail.com');
    }
    
    // Project media files
    match /projects/{projectToken}/{allPaths=**} {
      // Anyone can read media (for client viewing)
      allow read: if true;
      
      // Only admins can upload/update media
      allow write: if isAdmin()
        && request.resource.size < 10 * 1024 * 1024  // 10MB limit
        && request.resource.contentType.matches('image/.*|video/.*');
      
      // Only admins can delete media
      allow delete: if isAdmin();
    }
  }
}

